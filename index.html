<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hornet ‚Äî Interactive 3D</title>
  <style>
    html, body { margin:0; height:100%; background:#181a1b; overflow:hidden; }
    model-viewer { width:100%; height:100%; display:block; --poster-color:transparent; }
    .hud {
      position:fixed; left:12px; bottom:12px; color:#fff;
      background:rgba(0,0,0,.6); border:1px solid rgba(255,255,255,.25);
      border-radius:999px; padding:8px 12px; font:14px system-ui,sans-serif; pointer-events:none;
    }
    .hud.right { left:auto; right:12px; }
  </style>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>

  <model-viewer id="mv"
    src="hornet.glb"
    camera-controls
    auto-rotate
    rotation-per-second="20deg"
    exposure="1.0"
    shadow-intensity="0.9"
    environment-image="neutral"
    interaction-prompt="auto"
    alt="Hornet 3D model">
  </model-viewer>

  <div class="hud">üñ±Ô∏è Click = Attack ‚Ä¢ üñ±Ô∏è Double-Click = Power stance ‚Ä¢ üñ±Ô∏è Right-Click = Spin</div>
  <div class="hud right" id="status">Loading‚Ä¶ 0%</div>

  <script type="module">
    const mv = document.getElementById('mv');
    const statusEl = document.getElementById('status');
    const ANIM_NAME = 'HORNET RIGAction';

    // -------- progress HUD
    mv.addEventListener('progress', (e) => {
      const p = Math.round(100 * (e.detail?.totalProgress ?? 0));
      statusEl.textContent = p < 100 ? `Loading‚Ä¶ ${p}%` : 'Ready';
      if (p >= 100) setTimeout(() => statusEl.remove(), 1000);
    });

    mv.addEventListener('load', () => {
      console.log('‚úÖ Model loaded!');
      console.log('Available animations:', mv.availableAnimations);
    });

    // -------- tiny tween helper
    function tween(ms, update, done){
      const t0 = performance.now();
      function frame(t){
        const u = Math.min(1, (t - t0)/ms);
        update(u);
        if (u < 1) requestAnimationFrame(frame); else done && done();
      }
      requestAnimationFrame(frame);
    }

    // -------- helpers to read/set orientation (x y z in degrees)
    function parseOrientation(str){
      // "0deg 20deg 0deg" -> [0,20,0]
      const m = (str || '0deg 0deg 0deg').match(/-?\d+(\.\d+)?/g) || ['0','0','0'];
      return m.slice(0,3).map(Number);
    }
    function setOrientation([x,y,z]){
      mv.orientation = `${x}deg ${y}deg ${z}deg`;
    }

    // -------- left click: play built-in animation (pause after 2s)
    mv.addEventListener('click', async () => {
      await mv.updateComplete;
      if (Array.isArray(mv.availableAnimations) && mv.availableAnimations.includes(ANIM_NAME)) {
        mv.animationName = ANIM_NAME;
        mv.play();
        setTimeout(() => mv.pause(), 2000);
      } else {
        // fallback: a small whole-model wiggle
        const base = parseOrientation(mv.orientation);
        tween(600, (u) => {
          const amp = 18; // degrees
          const y = base[1] + Math.sin(u * Math.PI * 4) * amp * (1 - u * 0.3);
          setOrientation([base[0], y, base[2]]);
        }, () => setOrientation(base));
      }
    });

    // -------- double click: "power stance" (tilt & slight yaw)
    mv.addEventListener('dblclick', () => {
      const base = parseOrientation(mv.orientation);
      tween(700, (u) => {
        const ease = 1 - Math.pow(1-u, 3);
        const x = base[0] - Math.sin(ease * Math.PI) * 20;  // tilt forward
        const y = base[1] + Math.sin(ease * Math.PI * 2) * 10;
        setOrientation([x, y, base[2]]);
      }, () => setOrientation(base));
    });

    // -------- right click: smooth 360¬∞ spin (prevent context menu)
    mv.addEventListener('contextmenu', (e) => {
      e.preventDefault();
      const base = parseOrientation(mv.orientation);
      tween(1000, (u) => {
        const y = base[1] + u * 360; // degrees
        setOrientation([base[0], y, base[2]]);
      }, () => setOrientation(base));
    });

    // -------- error logger
    mv.addEventListener('error', () => {
      const tried = new URL(mv.getAttribute('src'), location.href).href;
      console.error('‚ùå Model could not be loaded. Tried:', tried);
      alert('Model could not be loaded.\nOpen Console (F12) for details.');
    });
  </script>

</body>
</html>
