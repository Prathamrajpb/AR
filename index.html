<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hornet ‚Äî Interactive 3D</title>
  <style>
    html, body {
      margin: 0;
      height: 100%;
      background: #181a1b;
      overflow: hidden;
    }
    model-viewer {
      width: 100%;
      height: 100%;
      display: block;
      --poster-color: transparent;
    }
    .hud {
      position: fixed;
      left: 12px;
      bottom: 12px;
      color: #fff;
      background: rgba(0, 0, 0, 0.6);
      border: 1px solid rgba(255, 255, 255, 0.25);
      border-radius: 999px;
      padding: 8px 12px;
      font: 14px system-ui, sans-serif;
      pointer-events: none;
    }
    .hud.right {
      left: auto;
      right: 12px;
    }
  </style>

  <!-- model-viewer script -->
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
</head>
<body>

  <model-viewer id="mv"
    src="hornet.glb"
    camera-controls
    auto-rotate
    rotation-per-second="20deg"
    exposure="1.0"
    shadow-intensity="0.9"
    environment-image="neutral"
    interaction-prompt="auto"
    alt="Hornet 3D model">
  </model-viewer>

  <div class="hud">
    üñ±Ô∏è Left Click = Play animation and Reset Position
  </div>
  <div class="hud right" id="status">Loading‚Ä¶ 0%</div>

  <script type="module">
    const mv = document.getElementById('mv');
    const statusEl = document.getElementById('status');
    const ANIM_NAME = 'HORNET RIGAction';

    let isAnimationPlaying = false;

    // progress HUD
    mv.addEventListener('progress', (e) => {
      const p = Math.round(100 * (e.detail?.totalProgress ?? 0));
      statusEl.textContent = p < 100 ? `Loading‚Ä¶ ${p}%` : 'Ready';
      if (p >= 100) setTimeout(() => statusEl.remove(), 1000);
    });

    mv.addEventListener('load', () => {
      console.log('‚úÖ Model loaded!');
      console.log('Available animations:', mv.availableAnimations);
    });

    // tiny helper for tweens
    function tween(duration, update, done) {
      const t0 = performance.now();
      function frame(t) {
        const u = Math.min(1, (t - t0) / duration);
        update(u);
        if (u < 1) requestAnimationFrame(frame);
        else if (done) done();
      }
      requestAnimationFrame(frame);
    }

    // LEFT CLICK ‚Üí Play animation / Reset to initial position
    mv.addEventListener('click', async () => {
      if (isAnimationPlaying) {
        // If animation is playing, reset the model to the initial position
        mv.reset();
        isAnimationPlaying = false; // Reset the state
      } else {
        // If animation is not playing, play it
        await mv.updateComplete;
        if (mv.availableAnimations?.includes(ANIM_NAME)) {
          mv.animationName = ANIM_NAME;
          mv.play();
          setTimeout(() => {
            mv.pause();
            isAnimationPlaying = false; // Reset animation state after play
          }, 2000);
          isAnimationPlaying = true; // Set the state to indicate the animation is playing
        } else {
          // If no animation found, perform a basic head shake as fallback
          const scene = await mv.getScene();
          const head = scene.getNodeByName('Head') || scene;
          const base = head.rotation.y;
          tween(600, (u) => {
            head.rotation.y = base + Math.sin(u * Math.PI * 4) * 0.3 * (1 - u * 0.3);
          }, () => head.rotation.y = base);
          isAnimationPlaying = true; // Mark that something has happened
        }
      }
    });

    // error display
    mv.addEventListener('error', () => {
      const tried = new URL(mv.getAttribute('src'), location.href).href;
      console.error('‚ùå Model could not be loaded. Tried:', tried);
      alert('Model could not be loaded.\nOpen Console (F12) to see details.');
    });
  </script>

</body>
</html>
